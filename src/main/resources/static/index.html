<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>首页</title>
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/vue/2.6.9/vue.min.js"></script>
    <link rel="stylesheet" href="https://cdn.bootcss.com/element-ui/2.6.1/theme-chalk/index.css">
    <script src="https://cdn.bootcss.com/element-ui/2.6.1/index.js"></script>

    <link rel="stylesheet" href="css/stylesheet.css">
</head>
<body>
<div id="app">
    <div id="top">
        <el-row>
            <el-col :offset="1" :span="4" style="line-height: 45px;">
                <span style="color:#ffffff;font-weight: bolder;" @click="onIndex">
                    用户：{{userInfo.name}}
                </span>
            </el-col>
            <el-col :offset="14" :span="4" style="line-height: 45px;">
                <span style="color:#ffffff" @click="onLogout">
                    logout
                </span>
            </el-col>
        </el-row>
    </div>
    <el-container>
        <el-aside style="width: 200px">
            <el-menu
                    default-active="1"
                    @select="handleSelect"
                    background-color="#545c64"
                    text-color="#fff"
                    active-text-color="#ffd04b">
                <el-submenu index="1">
                    <template slot="title">
                        <i class="el-icon-location"></i>
                        <span>学生</span>
                    </template>
                    <el-menu-item-group>
                        <template slot="title">功能</template>
                        <el-menu-item index="1-1">选课</el-menu-item>
                        <el-menu-item index="1-2">查看选课</el-menu-item>
                    </el-menu-item-group>
                </el-submenu>
                <el-submenu index="2">
                    <template slot="title">
                        <i class="el-icon-location"></i>
                        <span>教师</span>
                    </template>
                    <el-menu-item-group>
                        <template slot="title">功能</template>
                        <el-menu-item index="2-1">创建课程</el-menu-item>
                        <el-menu-item index="2-2">录入成绩</el-menu-item>
                    </el-menu-item-group>
                </el-submenu>
                <el-submenu index="3">
                    <template slot="title">
                        <i class="el-icon-location"></i>
                        <span>管理员</span>
                    </template>
                    <el-menu-item-group>
                        <template slot="title">功能</template>
                        <el-menu-item index="3-1">审核成绩</el-menu-item>
                        <el-menu-item index="3-2">设置事件</el-menu-item>
                    </el-menu-item-group>
                </el-submenu>
            </el-menu>
        </el-aside>
        <el-main>
            <el-card style="width: 360px;margin-left: 350px">
                <div slot="header">
                    <span>个人信息</span>
                    <!--<el-button style="float: right; padding: 3px 0" type="text">修改</el-button>-->
                </div>
                <div class="userInfo">学号：&nbsp;&nbsp;&nbsp;&nbsp;{{userInfo.id}}</div><br />
                <div class="userInfo">登录名：{{userInfo.username}}</div><br />
                <div class="userInfo">用户名：{{userInfo.name}}</div><br />
                <div class="userInfo">学院：&nbsp;&nbsp;&nbsp;&nbsp;{{college}}</div><br />
                <div class="userInfo">身份：&nbsp;&nbsp;&nbsp;&nbsp;{{status}}</div><br />
            </el-card>
        </el-main>
    </el-container>
</div>
</body>
<script>
    var vue = new Vue({
        el:'#app',
        data:{
            url:'index.html',
            userInfo:{
                id:1,
                username:'123',
                name:'testUser',
                collegeId:1,
                status:4,
            },
            collegeInfo:[
                {value:1,label:'软件学院'},
                {value:2,label:'计算机学院'},
                {value:3,label:'生命学院'},
                {value:4,label:'自动化学院'},
                {value:5,label:'宇航学院'},
                {value:6,label:'物理学院'}
            ],
            statusInfo:[
                {value:1,label:'学生'},
                {value:2,label:'教师'},
                {value:3,label:'管理员'}
            ],
        },
        computed:{
            college:function () {
                return this.collegeInfo[this.userInfo.collegeId-1].label;
            },
            status:function () {
                if(this.userInfo.status===4)
                    return '测试账号';
                return this.statusInfo[this.userInfo.status-1].label;
            },
        },
        methods:{
            onIndex(){
                window.location.href="index.html";
            },
            onLogout(){
                window.location.href="/logout";
            },
            getUserInfo(){
                $.ajax({
                    url:'/user/getUserInfo',
                    method:'get',
                    success(res){
                        vue.userInfo.id=res.id;
                        vue.userInfo.username=res.username;
                        vue.userInfo.name=res.name;
                        vue.userInfo.collegeId=res.collegeId;
                        vue.userInfo.status=res.status;
                    },
                    error(res){
                        vue.$message.error('获取用户信息出错！');
                    }
                });
            },
            getCollege(){
                $.ajax({
                    url:'/common/getCollege',
                    type:'get',
                    data:{},
                    success(res){

                        vue.collegeInfo=[];
                        for(var i = 0; i < res.length;i++){
                            vue.collegeInfo.push({value:res[i].id,
                                label:res[i].name});
                        }
                    },
                    error(res){
                        vue.$message.error('获取学院信息出错');
                    }
                });
            },
            handleSelect(key, keyPath) {
                let data=key.split("-");
                let jumpUrl=null;
                switch (data[0]) {
                    case '1':
                        if(this.userInfo.status===1||this.userInfo.status===4){
                            if(data[1]==='1'){
                                jumpUrl="selectCourse.html";
                                console.log(data[0],data[1]);
                            }
                            else{
                                jumpUrl="courseInfo.html";
                            }
                        }
                        break;
                    case '2':
                        if(this.userInfo.status===2||this.userInfo.status===4){
                            if(data[1]==='1'){
                                jumpUrl="createCourse.html";
                            }
                            else{
                                jumpUrl="inputGrade.html";
                            }
                        }
                        break;
                    case '3':
                        if(this.userInfo.status===3||this.userInfo.status===4){
                            if(data[1]==='1'){
                                jumpUrl="examineGrade.html";
                            }
                            else{
                                jumpUrl="createEvent.html";
                            }
                        }
                        break;
                }
                if(jumpUrl===null){
                    this.$message.error('请使用对应身份的功能');
                }
                else{
                    console.log(jumpUrl);
                    if(this.url!==jumpUrl){
                        window.location.href='html/'+jumpUrl;
                    }
                }
            }
        },
        mounted:function () {
            this.getUserInfo();
            this.getCollege();
        }
    })
</script>
</html>